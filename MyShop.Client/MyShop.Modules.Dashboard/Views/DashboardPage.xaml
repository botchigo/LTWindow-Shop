<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Modules.Dashboard.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyShop.Modules.Dashboard.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:graphql="using:MyShop.Infrastructure"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="30">
            <StackPanel Spacing="25">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{x:Bind ViewModel.WelcomeText, Mode=OneWay}" FontSize="28" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}"/>
                        <TextBlock Text="{x:Bind ViewModel.DateText, Mode=OneWay}" FontSize="14" Foreground="{ThemeResource SystemBaseMediumColor}" Margin="0,5,0,0"/>
                    </StackPanel>

                    <Button Grid.Column="1" Content="ðŸ”„ Refresh" Command="{x:Bind ViewModel.LoadDashboardDataCommand}" 
                            Style="{StaticResource AccentButtonStyle}" Padding="20,12" CornerRadius="8" FontWeight="SemiBold"/>
                </Grid>

                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="20" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Tá»•ng sáº£n pháº©m" FontSize="13" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                <TextBlock Text="{x:Bind ViewModel.TotalProducts, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}" Margin="0,8,0,0"/>
                                <TextBlock Text="sáº£n pháº©m" FontSize="11" Foreground="{ThemeResource SystemBaseLowColor}"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#E3F2FD" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ“¦" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="20" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="ÄÆ¡n hÃ ng hÃ´m nay" FontSize="13" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                <TextBlock Text="{x:Bind ViewModel.TodayOrders, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}" Margin="0,8,0,0"/>
                                <TextBlock Text="Ä‘Æ¡n hÃ ng" FontSize="11" Foreground="{ThemeResource SystemBaseLowColor}"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#FFF3E0" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ›’" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <Border Grid.Column="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="20" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Doanh thu hÃ´m nay" FontSize="13" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <TextBlock Text="{x:Bind ViewModel.TodayRevenue, Converter={StaticResource CurrencyConverter}, Mode=OneWay}" 
                                               FontSize="24" FontWeight="Bold" Foreground="#4CAF50"/>
                                </StackPanel>
                                <TextBlock Text="VNÄ" FontSize="11" Foreground="{ThemeResource SystemBaseLowColor}"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#E8F5E9" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ’°" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <Border Grid.Column="3" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="20" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Sáº¯p háº¿t hÃ ng" FontSize="13" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                <TextBlock Text="{x:Bind ViewModel.LowStockCount, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="#E53935" Margin="0,8,0,0"/>
                                <TextBlock Text="sáº£n pháº©m" FontSize="11" Foreground="{ThemeResource SystemBaseLowColor}"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#FFEBEE" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="âš ï¸" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>

                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="25" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <TextBlock Text="ðŸ“ˆ Doanh thu trong thÃ¡ng" FontSize="18" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}"/>
                            </Grid>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Height="220">
                                <Canvas x:Name="RevenueChart" Width="700" Height="200"/>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="25" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <StackPanel>
                            <TextBlock Text="ðŸ† Top 5 bÃ¡n cháº¡y" FontSize="18" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}" Margin="0,0,0,15"/>

                            <ListView ItemsSource="{x:Bind ViewModel.TopProducts, Mode=OneWay}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="graphql:IGetDashboardData_Top5BestSellers">
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0" Background="#F0E6FF" Width="40" Height="40" CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ“¦" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{x:Bind ProductName}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                                <TextBlock FontSize="11" Foreground="{ThemeResource SystemBaseMediumColor}">
                                                    <Run Text="ÄÃ£ bÃ¡n: "/>
                                                    <Run Text="{x:Bind TotalQuantity}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </Grid>

                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="25" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <StackPanel>
                            <TextBlock Text="âš ï¸ Sáº¯p háº¿t hÃ ng" FontSize="18" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}" Margin="0,0,0,15"/>

                            <ListView ItemsSource="{x:Bind ViewModel.LowStockProducts, Mode=OneWay}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="graphql:IGetDashboardData_Top5LowStock">
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0" Background="#FFEBEE" Width="40" Height="40" CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ“¦" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>

                                            <Border Grid.Column="2" Background="#FFEBEE" Padding="12,6" CornerRadius="6" VerticalAlignment="Center">
                                                <TextBlock FontWeight="Bold" Foreground="#E53935" FontSize="12">
                                                    <Run Text="CÃ²n: "/>
                                                    <Run Text="{x:Bind Stock}"/>
                                                </TextBlock>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="16" Padding="25" BorderThickness="1" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <StackPanel>
                            <TextBlock Text="ðŸ• ÄÆ¡n hÃ ng gáº§n Ä‘Ã¢y" FontSize="18" FontWeight="Bold" Foreground="{ThemeResource SystemBaseHighColor}" Margin="0,0,0,15"/>

                            <ListView ItemsSource="{x:Bind ViewModel.RecentOrders, Mode=OneWay}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="graphql:IGetDashboardData_Latest3Orders">
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0" Background="#F0F0F0" Width="40" Height="40" CornerRadius="20" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ§¾" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontWeight="SemiBold" FontSize="13">
                                                    <Run Text="#"/>
                                                    <Run Text="{x:Bind OrderId}"/>
                                                </TextBlock>
                                                <TextBlock Text="{x:Bind CreatedTime, Converter={StaticResource DateTimeConverter}}" FontSize="11" Foreground="{ThemeResource SystemBaseMediumColor}"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                <TextBlock Text="{x:Bind FinalPrice, Converter={StaticResource CurrencyConverter}}" FontWeight="Bold" FontSize="14" HorizontalAlignment="Right"/>

                                                <Border Background="{x:Bind Status, Converter={StaticResource StatusColorConverter}}" Padding="10,4" CornerRadius="4" Margin="0,5,0,0">
                                                    <TextBlock Text="{x:Bind Status}" FontSize="10" FontWeight="SemiBold" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </Grid>

            </StackPanel>
        </ScrollViewer>

        <Grid Background="{ThemeResource SystemControlPageBackgroundBaseLowBrush}" Opacity="0.8"
              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressRing IsActive="True" Width="60" Height="60"/>
        </Grid>
    </Grid>
</Page>
