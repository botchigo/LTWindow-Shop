<UserControl
    x:Class="MyShop.Dialogs.ProductCreateUpdateControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyShop.Dialogs"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Database.models"
    xmlns:format="using:Windows.Globalization.NumberFormatting"
    mc:Ignorable="d"
    Width="500">

    <UserControl.Resources>
        <format:DecimalFormatter x:Key="PriceFormatter" 
                                 IntegerDigits="1" 
                                 FractionDigits="0" 
                                 IsGrouped="True"/>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="24" Padding="0,0,12,0">

            <StackPanel Spacing="16">
                <TextBlock Text="Thông tin cơ bản" Style="{StaticResource BodyStrongTextBlockStyle}"/>

                <TextBox Header="Tên sản phẩm" 
                         Text="{x:Bind ViewModel.Product.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         PlaceholderText="Ví dụ: iPhone 15 Pro Max"
                         InputScope="Default"/>

                <ComboBox Header="Danh mục"
                          ItemsSource="{x:Bind ViewModel.Categories}"
                          DisplayMemberPath="Name"
                          SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                          HorizontalAlignment="Stretch"
                          PlaceholderText="Chọn loại sản phẩm"/>
            </StackPanel>

            <StackPanel Spacing="16">
                <TextBlock Text="Giá cả &amp; Mô tả" Style="{StaticResource BodyStrongTextBlockStyle}"/>

                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <NumberBox Grid.Column="0" Header="Giá nhập" 
                               Value="{x:Bind ViewModel.Product.ImportPrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                               SpinButtonPlacementMode="Compact"
                               PlaceholderText="0"
                               NumberFormatter="{StaticResource PriceFormatter}"/>

                    <NumberBox Grid.Column="1" Header="Giá bán" 
                               Value="{x:Bind ViewModel.Product.SalePrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                               SpinButtonPlacementMode="Compact"
                               PlaceholderText="0"
                               NumberFormatter="{StaticResource PriceFormatter}"/>
                </Grid>

                <TextBox Header="Mô tả chi tiết" 
                         Text="{x:Bind ViewModel.Product.Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True" Height="100" 
                         TextWrapping="Wrap"
                         PlaceholderText="Nhập mô tả về sản phẩm..."/>
            </StackPanel>

            <MenuFlyoutSeparator/>

            <StackPanel Spacing="12">
                <Grid>
                    <TextBlock Text="Thư viện ảnh" Style="{StaticResource BodyStrongTextBlockStyle}" VerticalAlignment="Center"/>
                    <TextBlock Text="{x:Bind ViewModel.ImageCollection.Count, Mode=OneWay}" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                               Style="{StaticResource CaptionTextBlockStyle}"
                               HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,4,0"/>
                </Grid>

                <GridView x:Name="ImageGridView" 
                          ItemsSource="{x:Bind ViewModel.ImageCollection, Mode=OneWay}"
                          SelectionMode="None"
                          IsItemClickEnabled="False">

                    <GridView.ItemTemplate>
                        <DataTemplate x:DataType="models:ProductImage">
                            <Grid Width="100" Height="100" CornerRadius="8" 
                                  BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="1">

                                <Image Source="{x:Bind Path, Converter={StaticResource PathToImageConverter}}" 
                                       Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center"/>

                                <Grid VerticalAlignment="Top" Height="40">
                                    <Grid.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                            <GradientStop Color="#66000000" Offset="0"/>
                                            <GradientStop Color="Transparent" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Grid.Background>
                                </Grid>

                                <Button VerticalAlignment="Top" HorizontalAlignment="Right" Margin="4"
                                        Click="OnRemoveImageClick"
                                        Style="{StaticResource SubtleButtonStyle}"
                                        Padding="4" Width="28" Height="28" CornerRadius="14"
                                        ToolTipService.ToolTip="Xóa ảnh">
                                    <FontIcon Glyph="&#xE711;" FontSize="12" Foreground="White" FontFamily="{StaticResource SymbolThemeFontFamily}"/>
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </GridView.ItemTemplate>

                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>

                <Button HorizontalAlignment="Stretch" Click="OnAddImageClick"
                        Background="Transparent" 
                        BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" 
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="0,20">
                    <Button.Content>
                        <StackPanel Spacing="8" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE8B9;" FontSize="24" Foreground="{ThemeResource AccentFillColorDefaultBrush}" FontFamily="{StaticResource SymbolThemeFontFamily}"/>
                            <TextBlock Text="Bấm để thêm ảnh mới" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Button.Content>
                </Button>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>

</UserControl>