<UserControl
    x:Class="MyShop.Dialogs.ProductCreateUpdateControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Database.models"
    xmlns:format="using:Windows.Globalization.NumberFormatting"
    mc:Ignorable="d"
    Width="500">

    <UserControl.Resources>
        <format:DecimalFormatter x:Key="PriceFormatter" IntegerDigits="1" FractionDigits="0" IsGrouped="True"/>
    </UserControl.Resources>

    <Grid RowSpacing="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" ColumnSpacing="16" Padding="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Width="48" Height="48" CornerRadius="12" 
                    Background="{ThemeResource AccentFillColorDefaultBrush}">
                <FontIcon Glyph="{x:Bind ViewModel.IsEditMode, Converter={StaticResource BoolToIconConverter}, ConverterParameter='EditMode'}" 
                          FontSize="20" Foreground="White" FontFamily="{StaticResource SymbolThemeFontFamily}"/>
            </Border>

            <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                <TextBlock Text="{x:Bind ViewModel.DialogTitle}" 
                           Style="{StaticResource SubtitleTextBlockStyle}" 
                           FontWeight="Bold"/>
                <TextBlock Text="Vui lòng điền đầy đủ thông tin bên dưới" 
                           Style="{StaticResource CaptionTextBlockStyle}" 
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Grid>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0,0,12,0">
            <StackPanel Spacing="24" Padding="0,0,0,12">

                <StackPanel Spacing="16" Background="{ThemeResource LayerFillColorDefaultBrush}" 
                            CornerRadius="8" Padding="16" BorderThickness="1" 
                            BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">

                    <TextBlock Text="Thông tin cơ bản" FontWeight="SemiBold"/>

                    <TextBox Header="Tên sản phẩm (*)" 
                             Text="{x:Bind ViewModel.Product.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             PlaceholderText="Ví dụ: iPhone 15 Pro Max"/>

                    <ComboBox Header="Danh mục (*)"
                              ItemsSource="{x:Bind ViewModel.Categories}"
                              DisplayMemberPath="Name"
                              SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                              HorizontalAlignment="Stretch"
                              PlaceholderText="Chọn loại sản phẩm"/>

                    <NumberBox Header="Số lượng tồn kho" 
                               Value="{x:Bind ViewModel.Product.Stock, Mode=TwoWay}"
                               SpinButtonPlacementMode="Inline"
                               Minimum="0"
                               PlaceholderText="0"/>
                </StackPanel>

                <StackPanel Spacing="16" Background="{ThemeResource LayerFillColorDefaultBrush}" 
                            CornerRadius="8" Padding="16" BorderThickness="1" 
                            BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">

                    <TextBlock Text="Chi tiết bán hàng" FontWeight="SemiBold"/>

                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <NumberBox Grid.Column="0" Header="Giá nhập" 
                                   Value="{x:Bind ViewModel.Product.ImportPrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                                   NumberFormatter="{StaticResource PriceFormatter}"/>

                        <NumberBox Grid.Column="1" Header="Giá bán" 
                                   Value="{x:Bind ViewModel.Product.SalePrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                                   NumberFormatter="{StaticResource PriceFormatter}"/>
                    </Grid>

                    <TextBox Header="Mô tả" 
                             Text="{x:Bind ViewModel.Product.Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             AcceptsReturn="True" Height="80" 
                             TextWrapping="Wrap"
                             PlaceholderText="Nhập mô tả về sản phẩm..."/>
                </StackPanel>

                <StackPanel Spacing="12">
                    <Grid>
                        <TextBlock Text="Thư viện ảnh" Style="{StaticResource BodyStrongTextBlockStyle}" VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="4">
                            <TextBlock Text="{x:Bind ViewModel.ImageCollection.Count, Mode=OneWay}" FontWeight="Bold"/>
                            <TextBlock Text="ảnh" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>

                    <GridView x:Name="ImageGridView" 
                              ItemsSource="{x:Bind ViewModel.ImageCollection, Mode=OneWay}"
                              SelectionMode="None" IsItemClickEnabled="False">

                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="models:ProductImage">
                                <Grid Width="80" Height="80" CornerRadius="8" Margin="0,0,8,8"
                                      BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="1">
                                    <Image Source="{x:Bind Path, Converter={StaticResource PathToImageConverter}}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"
                                           Stretch="UniformToFill"/>
                                    <Button VerticalAlignment="Top" HorizontalAlignment="Right" Margin="2"
                                            Click="OnRemoveImageClick" Style="{StaticResource SubtleButtonStyle}"
                                            Padding="0" Width="24" Height="24" CornerRadius="12" Background="#80000000">
                                        <FontIcon Glyph="&#xE711;" FontSize="10" Foreground="White"/>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>

                    <Button HorizontalAlignment="Stretch" Click="OnAddImageClick"
                            Background="Transparent" BorderThickness="1" 
                            BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8B9;" 
                                      Foreground="{ThemeResource AccentFillColorDefaultBrush}" 
                                      FontFamily="{StaticResource SymbolThemeFontFamily}"/>
                            <TextBlock Text="Tải ảnh lên"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>