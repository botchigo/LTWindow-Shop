<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyShop.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="#F5F5F5">

    <Page.Resources>
        <local:StatusColorConverter x:Key="StatusColorConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar Navigation -->
        <Border Grid.Column="0" Background="#1A1A2E">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Row="0" Padding="20" Margin="0,20,0,30">
                    <TextBlock Text="ðŸª MYSHOP" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Management System" FontSize="12" Foreground="#888888" Margin="0,5,0,0"/>
                </StackPanel>

                <!-- Menu Items -->
                <StackPanel Grid.Row="1" Spacing="5">
                    <TextBlock Text="MAIN MENU" FontSize="11" Foreground="#666666" Margin="20,0,0,10"/>
                    
                    <!-- Dashboard - Active -->
                    <Border Background="#7B5CD6" CornerRadius="8" Margin="10,0" Padding="15,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ“Š" FontSize="18"/>
                            <TextBlock Text="Dashboard" Foreground="White" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Products -->
                    <Border Background="Transparent" CornerRadius="8" Margin="10,0" Padding="15,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ“¦" FontSize="18"/>
                            <TextBlock Text="Products" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Orders -->
                    <Border Background="Transparent" CornerRadius="8" Margin="10,0" Padding="15,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ›’" FontSize="18"/>
                            <TextBlock Text="Orders" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Statistics -->
                    <Border Background="Transparent" CornerRadius="8" Margin="10,0" Padding="15,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ“ˆ" FontSize="18"/>
                            <TextBlock Text="Statistics" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Settings -->
                    <Border Background="Transparent" CornerRadius="8" Margin="10,0" Padding="15,12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="âš™ï¸" FontSize="18"/>
                            <TextBlock Text="Settings" Foreground="#AAAAAA" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Logout -->
                <Border Grid.Row="2" Background="Transparent" CornerRadius="8" Margin="10,0,10,30" Padding="15,12">
                    <Button Background="Transparent" BorderThickness="0" HorizontalAlignment="Stretch" Click="LogoutButton_Click">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸšª" FontSize="18"/>
                            <TextBlock Text="Log Out" Foreground="#FF6B6B" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Border>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Padding="30">
            <StackPanel Spacing="25">
                
                <!-- Header -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{Binding WelcomeText}" FontSize="28" FontWeight="Bold" Foreground="#1A1A2E"/>
                        <TextBlock Text="{Binding DateText}" FontSize="14" Foreground="#888888" Margin="0,5,0,0"/>
                    </StackPanel>

                    <Button Grid.Column="1" Content="ðŸ”„ Refresh" Click="RefreshButton_Click" 
                            Background="#7B5CD6" Foreground="White" Padding="20,12" CornerRadius="8"
                            FontWeight="SemiBold"/>
                </Grid>

                <!-- Statistics Cards -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Total Products -->
                    <Border Grid.Column="0" Background="White" CornerRadius="16" Padding="20" Margin="0,0,10,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Tá»•ng sáº£n pháº©m" FontSize="13" Foreground="#888888"/>
                                <TextBlock Text="{Binding TotalProducts}" FontSize="32" FontWeight="Bold" Foreground="#1A1A2E" Margin="0,8,0,0"/>
                                <TextBlock Text="sáº£n pháº©m" FontSize="11" Foreground="#AAAAAA"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#E3F2FD" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ“¦" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Today Orders -->
                    <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="20" Margin="5,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="ÄÆ¡n hÃ ng hÃ´m nay" FontSize="13" Foreground="#888888"/>
                                <TextBlock Text="{Binding TodayOrders}" FontSize="32" FontWeight="Bold" Foreground="#1A1A2E" Margin="0,8,0,0"/>
                                <TextBlock Text="Ä‘Æ¡n hÃ ng" FontSize="11" Foreground="#AAAAAA"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#FFF3E0" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ›’" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Today Revenue -->
                    <Border Grid.Column="2" Background="White" CornerRadius="16" Padding="20" Margin="5,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Doanh thu hÃ´m nay" FontSize="13" Foreground="#888888"/>
                                <TextBlock FontSize="32" FontWeight="Bold" Foreground="#4CAF50" Margin="0,8,0,0">
                                    <Run Text="{Binding TodayRevenue}"/>
                                    <Run Text=" Ä‘" FontSize="20"/>
                                </TextBlock>
                                <TextBlock Text="VNÄ" FontSize="11" Foreground="#AAAAAA"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#E8F5E9" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ’°" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Low Stock Alert -->
                    <Border Grid.Column="3" Background="White" CornerRadius="16" Padding="20" Margin="10,0,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Sáº¯p háº¿t hÃ ng" FontSize="13" Foreground="#888888"/>
                                <TextBlock Text="{Binding LowStockCount}" FontSize="32" FontWeight="Bold" Foreground="#E53935" Margin="0,8,0,0"/>
                                <TextBlock Text="sáº£n pháº©m" FontSize="11" Foreground="#AAAAAA"/>
                            </StackPanel>
                            <Border Grid.Column="1" Background="#FFEBEE" Width="55" Height="55" CornerRadius="27" VerticalAlignment="Center">
                                <TextBlock Text="âš ï¸" FontSize="26" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Charts and Lists Row -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Monthly Revenue Chart -->
                    <Border Grid.Column="0" Background="White" CornerRadius="16" Padding="25" Margin="0,0,10,0">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <TextBlock Text="ðŸ“ˆ Doanh thu trong thÃ¡ng" FontSize="18" FontWeight="Bold" Foreground="#1A1A2E"/>
                                <TextBlock Text="{Binding MonthYearText}" HorizontalAlignment="Right" FontSize="13" Foreground="#888888" VerticalAlignment="Center"/>
                            </Grid>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Height="220">
                                <Canvas x:Name="RevenueChart" Width="700" Height="200"/>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>

                    <!-- Top Selling Products -->
                    <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="25" Margin="10,0,0,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ† Top 5 bÃ¡n cháº¡y" FontSize="18" FontWeight="Bold" Foreground="#1A1A2E" Margin="0,0,0,15"/>
                            <ListView ItemsSource="{Binding TopProducts}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#F0E6FF" Width="40" Height="40" CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ“¦" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding ProductName}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                                <TextBlock FontSize="11" Foreground="#888888">
                                                    <Run Text="ÄÃ£ bÃ¡n: "/>
                                                    <Run Text="{Binding TotalQuantity}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Bottom Row -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Low Stock Products -->
                    <Border Grid.Column="0" Background="White" CornerRadius="16" Padding="25" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Text="âš ï¸ Sáº¯p háº¿t hÃ ng" FontSize="18" FontWeight="Bold" Foreground="#1A1A2E" Margin="0,0,0,15"/>
                            <ListView ItemsSource="{Binding LowStockProducts}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#FFEBEE" Width="40" Height="40" CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ“¦" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13" TextTrimming="CharacterEllipsis" Foreground="#1A1A2E"/>
                                            </StackPanel>
                                            <Border Grid.Column="2" Background="#FFEBEE" Padding="12,6" CornerRadius="6" VerticalAlignment="Center">
                                                <TextBlock FontWeight="Bold" Foreground="#E53935" FontSize="12">
                                                    <Run Text="CÃ²n: "/>
                                                    <Run Text="{Binding Stock}"/>
                                                </TextBlock>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>

                    <!-- Recent Orders -->
                    <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="25" Margin="10,0,0,0">
                        <StackPanel>
                            <TextBlock Text="ðŸ• ÄÆ¡n hÃ ng gáº§n Ä‘Ã¢y" FontSize="18" FontWeight="Bold" Foreground="#1A1A2E" Margin="0,0,0,15"/>
                            <ListView ItemsSource="{Binding RecentOrders}" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,8" Padding="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Background="#F0F0F0" Width="40" Height="40" CornerRadius="20" Margin="0,0,12,0">
                                                <TextBlock Text="ðŸ§¾" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontWeight="SemiBold" FontSize="13">
                                                    <Run Text="#"/>
                                                    <Run Text="{Binding OrderId}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding CreatedTime}" FontSize="11" Foreground="#888888"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                <TextBlock FontWeight="Bold" Foreground="#1A1A2E" FontSize="14" HorizontalAlignment="Right">
                                                    <Run Text="{Binding FinalPrice}"/>
                                                    <Run Text=" Ä‘" FontSize="11"/>
                                                </TextBlock>
                                                <Border Background="{Binding Status, Converter={StaticResource StatusColorConverter}}" 
                                                        Padding="10,4" CornerRadius="4" Margin="0,5,0,0">
                                                    <TextBlock Text="{Binding Status}" FontSize="10" FontWeight="SemiBold" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </Border>
                </Grid>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
